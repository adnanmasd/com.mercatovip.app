<template v-for="row in homePageContent">
                <template v-for="row2 in row['value']">
                    {{/*this.console.log(row2)*/}}
                    <template v-if="row2['_link'] == 'Sliders'">
                        <f7-row>
                            <f7-col :width="row2.width">
                                <f7-swiper v-if="row2.image.length" pagination :params="{preloadImages: true,spaceBetween: 10,loop:true,centeredSlides:true,autoplay:true}">
                                    <f7-swiper-slide class="image-slider" v-for="i in row2.image" :key="row.id">
                                        <span v-if="i.value['txt' + currentLanguageId]" class="slider-title">{{ i.value['txt' + currentLanguageId] }}</span>
                                        <img @click="navigate(i.value.link)" :src="getCMSImage(i.value['img' + currentLanguageId].path)" class="slider lazy swiper-lazy">
                                        <div class="swiper-lazy-preloader swiper-lazy-preloader-black"></div>
                                    </f7-swiper-slide>
                                </f7-swiper>
                            </f7-col>
                        </f7-row>
                    </template>

                    <template v-if="row2['_link'] == 'Banners'">
                        <f7-block-title v-if="row2.name_as_heading && row2.show_name">{{row2.name[currentLanguageId]}}</f7-block-title>
                        <f7-block class="home-page-block" :style="row2.full_width ? 'padding : 0' : ''">
                            <f7-row :class="row2['full_width'] ? row2['full_width'] : ''">
                                <f7-col :width="row2['width']">
                                    <span class="banner-title" v-if="row2.name[currentLanguageId] && !row2.name_as_heading  && row2.show_name">{{row2.name[currentLanguageId]}}</span>
                                    <img @click="navigate(row2.link)" :src="getCMSImage(row2.image[currentLanguageId].path)" class="specialBanner">
                                </f7-col>
                            </f7-row>
                        </f7-block>
                    </template>

                    <template v-if="row2['_link'] == 'CarouselBanner'">
                        <f7-block class="home-page-block" :style="row2.full_width ? 'padding : 0' : ''">
                            <f7-swiper class="pagination-below" :pagination="row2.length > row2.show_per_row" :params="{preloadImages: false,lazy: true,freeMode: true,slidesPerView: row2.show_per_row,slidesPerColumn: 1,spaceBetween:10}" style="width:100%">
                                <f7-swiper-slide v-for="i in row2.image" class="image-slider" :key="i.id">
                                    <span class="banner-title">{{i.value['txt' + currentLanguageId]}}</span>
                                    <img @click="navigate(i.value.link)" :src="getCMSImage(i.value['img' + currentLanguageId].path)" class="banner lazy swiper-lazy">
                                    <div class="swiper-lazy-preloader swiper-lazy-preloader-black"></div>
                                </f7-swiper-slide>
                            </f7-swiper>
                        </f7-block>
                    </template>

                    <template v-if="row2['_link'] == 'CarouselProducts'">
                        <f7-block-title v-if="row2.title[currentLanguageId]">{{row2.title[currentLanguageId]}}</f7-block-title>
                        <f7-block :style="row2.full_width ? 'padding : 0' : ''" class="carouselHomePage home-page-block">
                            <f7-swiper :params="{slidesPerView: 2.3, spaceBetween:1,loop: false,autoplay: true,freeMode: true}">
                                <template v-for="id in row2.product_id">
                                    <product-card :product_id="id.value">
                                    </product-card>
                                </template>
                            </f7-swiper>
                        </f7-block>
                    </template>

                    <template v-if="row2['_link'] == 'CarouselCategory'">
                        <template v-for="cat in row2['category_id']">
                            <f7-block-title v-if="cat.value['txt' + currentLanguageId]">{{cat.value['txt' + currentLanguageId]}}<span class="pull-right"><f7-link class="color-blue" :href="cat.value.link">{{$t("home.seeAll")}}</f7-link></span></f7-block-title>
                            <f7-block :style="row2.full_width ? 'padding : 0' : ''" class="carouselHomePage home-page-block">
                                <category-carousel :category_id="cat.value.id"></category-carousel>
                            </f7-block>
                        </template>
                    </template>

                    <template v-if="row2['_link'] == 'CustomHTML'">
                        <div v-html="row2.html[currentLanguageId]"></div>
                    </template>
                </template>
            </template>





































            <template>
<f7-swiper :params="{slidesPerView: 2.3, spaceBetween:1,loop: false,freeMode: true,observer: true}">
    <f7-swiper-slide v-if="loaded == false" v-for="row in 1,4">
        <f7-card class="animated-background">
            <div class="background-masker header-top"></div>
            <div class="background-masker header-left"></div>
            <div class="background-masker header-right"></div>
            <div class="background-masker header-bottom"></div>
            <div class="background-masker content-top"></div>
        </f7-card>
    </f7-swiper-slide>
    <f7-swiper-slide v-else v-for="p in products">
        <f7-card>
            <f7-card-header>
                <div @click='navigate("/product?product_id=" + p.id)'><img :src="p.image" class="product-card-image"><span v-if="p.special" class="tag left-tag">{{getDiscount(p.special,p.price)}}%</span><span v-if="is_new(p.date_added)" class="tag right-tag">NEW</span></div>
            </f7-card-header>
            <f7-card-content>
                <div @click='navigate("/product?product_id=" + p.id)' class="color-black">
                    <!-- <span class="product-cart-title">{{p.name | andFilter}}</span>
                                    <br/> <span v-if="p.special" class="old-price">{{p.price_formated}}</span> -->
                    <br/> <span v-if="p.special" class="price">{{p.special_formated}}</span> <span v-if="!p.special" class="price">{{p.price_formated}}</span>
                </div>
            </f7-card-content>
            <!-- <f7-card-footer>
                <f7-segmented style="width:100%" v-if="theme.ios">
                    <f7-button class="product-card-footer-button" color="white" @click="shareProduct(p.name,p.thumb,p.id)" icon-f7="share"></f7-button>
                    <template v-if="!is_favourite(p.id)">
                        <f7-button class="product-card-footer-button" color="white" @click="addToWishlist(p.id)" icon-f7="heart"></f7-button>
                    </template>
                    <template v-else-if="is_favourite(p.id)">
                        <f7-button class="product-card-footer-button" color="white" @click="removeFromWishlist(p.id)" icon-f7="heart_fill" icon-color="red"></f7-button>
                    </template>
                </f7-segmented>
                <f7-segmented style="width:100%" v-if="theme.md">
                    <f7-button class="product-card-footer-button" color="black" @click="shareProduct(p.name,p.thumb,p.id)" icon-material="share"></f7-button>
                    <template v-if="!is_favourite(p.id)">
                        <f7-button class="product-card-footer-button" color="black" @click="addToWishlist(p.id)" icon-material="favorite_border"></f7-button>
                    </template>
                    <template v-else-if="is_favourite(p.id)">
                        <f7-button class="product-card-footer-button" color="black" @click="removeFromWishlist(p.id)" icon-material="favorite" icon-color="red"></f7-button>
                    </template>
                </f7-segmented>
            </f7-card-footer> -->
        </f7-card>
    </f7-swiper-slide>
</f7-swiper>
</template>

<script>
import axios from "axios";
import store from "src/assets/vuex/store.js";
import cms_config from "cms.js";
import api from "api.js";

export default {
    name: 'category',
    props: {
        category_id: {
            type: Number,
            required: true
        }
    },
    data() {
        return {
            products: [],
            loaded: false
        }
    },
    mounted() {
        var self = this;
        var headers = api.headers(localStorage.getItem('session_id'));
        headers['X-Oc-Image-Dimension'] = "227x237";
        axios({
            method: "GET",
            url: api.baseUrl + api.urls.getProductsByCategoryFilterPageLimit.replace("{id}", this.category_id).replace("{limit}", 15).replace("{page}", 1),
            headers: headers,
            transformResponse: function (req) {
                var newReq = req.replace(/[\r\n|\n\r]/g, '');
                return JSON.parse(newReq)
            }
        }).then(function (response) {
            if (response.data.data != [])
                self.products = response.data.data
            self.loaded = true;
        });
    },
    methods: {
        is_favourite(pid) {
            let wishlist = store.state.user ? store.state.user.wishlist : [];
            for (let j in wishlist) {
                if (wishlist[j].product_id == pid) return true;
            }
            return false;
        },
        addToWishlist(product_id) {
            self.$f7.preloader.show();
            axios({
                    method: "POST",
                    url: api.baseUrl + api.urls.wishlist.replace("{id}", product_id),
                    headers: api.headers(localStorage.getItem("session_id"))
                })
                .then(function (response) {
                    if (response.status == 200) {
                        store.dispatch("fetchWishlist");
                    }
                })
                .catch(function (error) {
                    var t = self.$f7.toast.create({
                        text: error.response.data.error,
                        closeTimeout: 5000,
                        destroyOnClose: true,
                        position: "top",
                        cssClass: "toast-red"
                    });
                    t.open();
                    navigator.vibrate([80, 80, 80]);
                });
            self.$f7.preloader.hide();
        },
        removeFromWishlist(product_id) {
            self.$f7.preloader.show();
            axios({
                    method: "DELETE",
                    url: api.baseUrl + api.urls.wishlist.replace("{id}", product_id),
                    headers: api.headers(localStorage.getItem("session_id"))
                })
                .then(function (response) {
                    if (response.status == 200) {
                        store.dispatch("fetchWishlist");
                    }
                })
                .catch(function (error) {
                    var t = self.$f7.toast.create({
                        text: error.response.data.error,
                        closeTimeout: 5000,
                        destroyOnClose: true,
                        position: "top",
                        cssClass: "toast-red"
                    });
                    t.open();
                    navigator.vibrate([80, 80, 80]);
                });
            self.$f7.preloader.hide();
        },
        is_new(date) {
            var d = Date.parse(date);
            var t = new Date();
            return Math.round((t - d) / (1000 * 60 * 60 * 24)) <= 30;
        },
        getDiscount(discount, price) {
            let val = 1 - discount / price;
            return Math.floor(val * 100);
        },
        navigate(link) {
            this.$f7router.navigate(link);
        }
    },
};
</script>
